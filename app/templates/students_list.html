{% extends "base.html" %}

{% block title %}Students List - AI Attendance Tracker{% endblock %}

{% block content %}
<div class="students-list">
    <div class="page-header">
        <h1>ğŸ‘¥ Students List</h1>
        <div class="header-actions">
            {% if current_user.is_authenticated %}
            <a href="{{ url_for('students.add_student') }}" class="btn btn-primary">â• Add Student</a>
            {% endif %}
            <a href="{{ url_for('students.export_students') }}" class="btn btn-secondary">ğŸ“¥ Export CSV</a>
        </div>
    </div>
    
    <div class="search-box">
        <form method="GET" action="{{ url_for('students.list_students') }}">
            <input type="text" name="search" placeholder="Search by roll no or name..." 
                   value="{{ search }}" class="form-control">
            <button type="submit" class="btn btn-primary">ğŸ” Search</button>
            {% if search %}
            <a href="{{ url_for('students.list_students') }}" class="btn btn-secondary">Clear</a>
            {% endif %}
        </form>
    </div>
    
    {% if students %}
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>Roll No</th>
                    <th>Name</th>
                    <th>Semester</th>
                    <th>Attendance %</th>
                    <th>Avg Marks</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for student in students %}
                <tr>
                    <td><strong>{{ student.roll_no }}</strong></td>
                    <td>{{ student.name }}</td>
                    <td>{{ student.semester }}</td>
                    <td>
                        {% if student.attendance %}
                            <span class="badge {% if student.attendance.has_shortage %}badge-danger{% else %}badge-success{% endif %}">
                                {{ "%.2f"|format(student.attendance.attendance_percentage) }}%
                            </span>
                        {% else %}
                            <span class="badge badge-secondary">N/A</span>
                        {% endif %}
                    </td>
                    <td>{{ "%.2f"|format(student.average_marks) }}</td>
                    <td class="actions">
                        <a href="{{ url_for('students.view_student', id=student.id) }}" 
                           class="btn btn-sm btn-info" title="View Details">ğŸ‘ï¸</a>
                        <a href="{{ url_for('students.student_report', id=student.id) }}" 
                           class="btn btn-sm btn-info" title="Full Report">ğŸ“„</a>
                        {% if current_user.is_authenticated %}
                        <a href="{{ url_for('students.edit_student', id=student.id) }}" 
                           class="btn btn-sm btn-warning" title="Edit">âœï¸</a>
                        <form method="POST" action="{{ url_for('students.delete_student', id=student.id) }}" 
                              style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this student? All related attendance and performance records will also be deleted.');">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="btn btn-sm btn-danger" title="Delete">ğŸ—‘ï¸</button>
                        </form>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    {% if pagination.pages > 1 %}
    <div class="pagination">
        {% if pagination.has_prev %}
        <a href="{{ url_for('students.list_students', page=pagination.prev_num, search=search) }}" 
           class="btn btn-sm">â† Previous</a>
        {% endif %}
        
        <span class="page-info">Page {{ pagination.page }} of {{ pagination.pages }}</span>
        
        {% if pagination.has_next %}
        <a href="{{ url_for('students.list_students', page=pagination.next_num, search=search) }}" 
           class="btn btn-sm">Next â†’</a>
        {% endif %}
    </div>
    {% endif %}
    
    {% else %}
    <div class="empty-state">
        <p>No students found.</p>
        {% if current_user.is_authenticated %}
        <a href="{{ url_for('students.add_student') }}" class="btn btn-primary">Add First Student</a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}
